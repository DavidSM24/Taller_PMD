"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2956],{2956:(M,f,r)=>{r.r(f),r.d(f,{AgencyListPageModule:()=>E});var m=r(6019),p=r(9010),l=r(2651),u=r(8725),g=r(4762),A=r(2483),e=r(865),Z=r(9574),y=r(371),T=r(9311),C=r(7524);function v(s,h){if(1&s){const i=e.EpF();e.TgZ(0,"ion-row",22),e.TgZ(1,"ion-col",23),e.TgZ(2,"ion-text",24),e.NdJ("click",function(){const c=e.CHM(i).$implicit;return e.oxw().edit(c)}),e._UZ(3,"ion-icon",25),e.qZA(),e.qZA(),e.TgZ(4,"ion-col",26),e.TgZ(5,"ion-text"),e._uU(6),e.qZA(),e.qZA(),e.TgZ(7,"ion-col",26),e.TgZ(8,"ion-text"),e._uU(9),e.qZA(),e.qZA(),e.TgZ(10,"ion-col",26),e.TgZ(11,"ion-text"),e._uU(12),e.qZA(),e.qZA(),e.TgZ(13,"ion-col",26),e.TgZ(14,"ion-text"),e._uU(15),e.qZA(),e.qZA(),e.TgZ(16,"ion-col",23),e.TgZ(17,"ion-text",27),e.NdJ("click",function(){const c=e.CHM(i).$implicit;return e.oxw().showDeleteMenu(c)}),e._UZ(18,"ion-icon",28),e.qZA(),e.qZA(),e.qZA()}if(2&s){const i=h.$implicit;e.xp6(6),e.hij(" ",i.zipCode," "),e.xp6(3),e.hij(" ",i.myInsuranceCompany.cia_Name," "),e.xp6(3),e.hij(" ",i.location," "),e.xp6(3),e.hij(" ",i.points," ")}}const x=[{path:"",component:(()=>{class s{constructor(i,t,n,c,o,a,d){this.as=i,this.AlertCtrl=t,this.modalCtrl=n,this.pt=c,this.uts=o,this.authS=a,this.us=d,this.agencies=[],this.oldAgencies=[],this.searchStr=""}ngOnInit(){}ionViewWillEnter(){return(0,g.mG)(this,void 0,void 0,function*(){this.niTems=Math.ceil(this.pt.height()/20+10),console.log(this.as.added),this.as.added?(this.reset(null),this.as.added=!1):yield this.loadAgencies()})}loadAgencies(i){return(0,g.mG)(this,void 0,void 0,function*(){let t=[];0==this.agencies.length&&(yield this.uts.presentLoading(),this.infinite.disabled=!1,this.oldInfinite=!1,t=yield this.as.getAllPaged(this.niTems,0),this.agencies=this.agencies.concat(t),this.agencies=this.sortList(this.agencies),this.oldAgencies=[],this.oldAgencies=this.oldAgencies.concat(t)),t.length<this.niTems&&(this.infinite.disabled=!0,this.oldInfinite=!0),i&&i.target.complete(),yield this.uts.hideLoading()})}edit(i){return(0,g.mG)(this,void 0,void 0,function*(){try{const t=yield this.modalCtrl.create({component:A.L,cssClass:"fullscreen",componentProps:{agency:i}});yield t.present();const n=yield t.onDidDismiss();if(null!=n.data){let c=this.agencies.indexOf(i);this.agencies[c]=n.data.newAgency,this.oldAgencies.forEach(o=>{if(o.id==n.data.newAgency.id){let a=this.oldAgencies.indexOf(o);this.oldAgencies[a]=this.agencies[c]}})}}catch(t){console.log(t)}})}delete(i){return(0,g.mG)(this,void 0,void 0,function*(){if(i.myCarRepairs.length>0||i.myExchangesGifts.length>0){let t="Error. ";i.myCarRepairs.length>0&&i.myExchangesGifts.length>0?t+="No se puede eliminar la agencia porque tiene reparaciones y pedidos asociados.":i.myCarRepairs.length>0?t+="No se puede eliminar la agencia porque tiene reparaciones asociadas.":i.myExchangesGifts.length>0&&(t+="No se puede eliminar la agencia porque tiene pedidos asociados."),this.uts.presentToast(t,"danger","ban")}else{let t=i.myUser;yield this.uts.presentLoading();const n=yield this.as.delete(i);let c=this.agencies.indexOf(i,0);yield this.uts.hideLoading(),n?(c>-1&&(this.agencies.splice(c,1),this.oldAgencies.forEach(a=>{if(a.id==i.id){let d=this.oldAgencies.indexOf(a);this.oldAgencies.splice(d,1)}}),(yield this.us.delete(t))||this.uts.presentToast("Error al eliminar el usuario asociado.","danger","ban")),this.uts.presentToast("Agencia eliminada correctamente.","success","checkmark-circle-outline")):this.uts.presentToast("Error al eliminar la agencia...","danger","ban")}})}showDeleteMenu(i){return(0,g.mG)(this,void 0,void 0,function*(){yield(yield this.AlertCtrl.create({header:"Confirmaci\xf3n",message:"\xbfDesea eliminar esta Agencia? Tambi\xe9n se eliminar\xe1 el usuario asociado.",buttons:[{text:"Eliminar",cssClass:"rojo",handler:()=>{this.delete(i)}},{text:"Cancelar",cssClass:"secondary",role:"cancel"}]})).present()})}infiniteLoad(i){return(0,g.mG)(this,void 0,void 0,function*(){let t=[];this.infinite.disabled||(t=yield this.as.getAllPaged(this.niTems,this.agencies.length),this.agencies=this.agencies.concat(t),this.oldAgencies=this.oldAgencies.concat(t),t.length<30&&(this.infinite.disabled=!0,this.oldInfinite=!0))})}onSearchChange(i){this.searchStr=i.detail.value}reset(i){return(0,g.mG)(this,void 0,void 0,function*(){this.infinite.disabled=!1,this.oldInfinite=!1,this.agencies=[],this.loadAgencies(i)})}logout(){this.authS.logout()}searchChange(i){return(0,g.mG)(this,void 0,void 0,function*(){this.searchStr=i.detail.value;let t=[],n=[];this.agencies=[];let c=this.searchStr.length;c>0?(yield this.uts.presentLoading(),n=yield this.as.getByUserNamePaged(this.searchStr,99999,0),n.forEach(o=>{let a=!0;t.forEach(d=>{d.id==o.id&&(a=!1)}),a&&t.push(o)}),n=yield this.as.getByAddress(this.searchStr),n.forEach(o=>{let a=!0;t.forEach(d=>{d.id==o.id&&(a=!1)}),a&&t.push(o)}),n=yield this.as.getByCompany(this.searchStr),n.forEach(o=>{let a=!0;t.forEach(d=>{d.id==o.id&&(a=!1)}),a&&t.push(o)}),n=yield this.as.getByLocation(this.searchStr),n.forEach(o=>{let a=!0;t.forEach(d=>{d.id==o.id&&(a=!1)}),a&&t.push(o)}),+this.searchStr>=0&&(n=yield this.as.getByPoints(+this.searchStr),n.forEach(o=>{let a=!0;t.forEach(d=>{d.id==o.id&&(a=!1)}),a&&t.push(o)})),+this.searchStr>=0&&(n=yield this.as.getByZipcode(+this.searchStr),n.forEach(o=>{let a=!0;t.forEach(d=>{d.id==o.id&&(a=!1)}),a&&t.push(o)})),this.agencies=t,this.agencies=this.sortList(this.agencies),this.infinite.disabled=!0,yield this.uts.hideLoading()):c<1&&(this.agencies=[],this.agencies=this.agencies.concat(this.oldAgencies),this.agencies=this.sortList(this.agencies),this.infinite.disabled=this.oldInfinite,yield this.uts.hideLoading())})}sortList(i){return null!=i&&i.length>1&&(i=i.sort((t,n)=>t.myInsuranceCompany.cia_Name>n.myInsuranceCompany.cia_Name?1:t.myInsuranceCompany.cia_Name<n.myInsuranceCompany.cia_Name?-1:t.id>n.id?1:t.id<n.id?-1:0)),i}}return s.\u0275fac=function(i){return new(i||s)(e.Y36(Z.Y),e.Y36(l.Br),e.Y36(l.IN),e.Y36(l.t4),e.Y36(y.f),e.Y36(T.e),e.Y36(C.K))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-agency-list"]],viewQuery:function(i,t){if(1&i&&e.Gf(l.ju,5),2&i){let n;e.iGM(n=e.CRH())&&(t.infinite=n.first)}},decls:40,vars:3,consts:[[3,"translucent"],["color","primary"],["slot","end",1,"icon-div-container",2,"margin-right","1%"],["title","Nuevo","routerLink","/tab-administrator/user/create"],["slot","end",1,"icon-logout",2,"pointer-events","none","zoom","1.5","cursor","pointer","content","url(../../../../assets/icon/add-circle-outline.png)"],["title","Lista de Usuarios","routerLink","/tab-administrator/user/list"],["slot","end",1,"icon-logout",2,"pointer-events","none","zoom","1.3","cursor","pointer","content","url( ../../../../assets/icon/user_list.png)"],["title","Lista de Compa\xf1\xedas de Seguros","routerLink","/tab-administrator/company/list"],["slot","end",1,"icon-logout",2,"pointer-events","none","zoom","1.3","cursor","pointer","content","url( ../../../../assets/icon/company_list.png)"],["title","Cerrar Sesi\xf3n",3,"click"],["slot","end","name","log-out-outline",1,"icon-logout",2,"pointer-events","none","zoom","1.7","cursor","pointer"],["placeholder","Encuentra la agencia que est\xe1s buscando...","debounce","1000","inputmode","text","type","text","showCancelButton","always",3,"ionChange"],[1,"header-row"],["size","1",2,"border","0px !important"],["size","2.5",2,"border","0px !important"],[2,"background-color","white",3,"fullscreen"],["slot","fixed",3,"ionRefresh"],[1,"body"],[1,"ion-text-center"],["let","","class","row",4,"ngFor","ngForOf"],["threshold","100px",3,"ionInfinite"],["loadingSpinner","bubbles","loadingText",""],["let","",1,"row"],["size","1"],["title","Editar",1,"icon-div-container",3,"click"],["name","pencil",2,"color","#22388c","pointer-events","none"],["size","2.5"],["title","Eliminar",1,"icon-div-container",3,"click"],["name","trash","color","danger",2,"pointer-events","none"]],template:function(i,t){1&i&&(e.TgZ(0,"ion-header",0),e.TgZ(1,"ion-toolbar",1),e.TgZ(2,"ion-title"),e._uU(3,"Lista de Agencias"),e.qZA(),e.TgZ(4,"ion-buttons",2),e.TgZ(5,"div",3),e._UZ(6,"ion-icon",4),e.qZA(),e.TgZ(7,"div",5),e._UZ(8,"ion-icon",6),e.qZA(),e.TgZ(9,"div",7),e._UZ(10,"ion-icon",8),e.qZA(),e.TgZ(11,"div",9),e.NdJ("click",function(){return t.logout()}),e._UZ(12,"ion-icon",10),e.qZA(),e.qZA(),e.qZA(),e.TgZ(13,"ion-toolbar",1),e.TgZ(14,"ion-searchbar",11),e.NdJ("ionChange",function(c){return t.searchChange(c)}),e.qZA(),e.TgZ(15,"ion-row",12),e.TgZ(16,"ion-col",13),e._UZ(17,"ion-text"),e.qZA(),e.TgZ(18,"ion-col",14),e.TgZ(19,"ion-text"),e._uU(20,"C\xf3digo Zip"),e.qZA(),e.qZA(),e.TgZ(21,"ion-col",14),e.TgZ(22,"ion-text"),e._uU(23,"Compa\xf1\xeda"),e.qZA(),e.qZA(),e.TgZ(24,"ion-col",14),e.TgZ(25,"ion-text"),e._uU(26,"Localidad"),e.qZA(),e.qZA(),e.TgZ(27,"ion-col",14),e.TgZ(28,"ion-text"),e._uU(29,"Puntos"),e.qZA(),e.qZA(),e.TgZ(30,"ion-col",13),e._UZ(31,"ion-text"),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.TgZ(32,"ion-content",15),e.TgZ(33,"ion-refresher",16),e.NdJ("ionRefresh",function(c){return t.reset(c)}),e._UZ(34,"ion-refresher-content"),e.qZA(),e.TgZ(35,"div",17),e.TgZ(36,"ion-grid",18),e.YNc(37,v,19,4,"ion-row",19),e.qZA(),e.TgZ(38,"ion-infinite-scroll",20),e.NdJ("ionInfinite",function(c){return t.infiniteLoad(c)}),e._UZ(39,"ion-infinite-scroll-content",21),e.qZA(),e.qZA(),e.qZA()),2&i&&(e.Q6J("translucent",!1),e.xp6(32),e.Q6J("fullscreen",!0),e.xp6(5),e.Q6J("ngForOf",t.agencies))},directives:[l.Gu,l.sr,l.wd,l.Sm,l.YI,u.rH,l.gu,l.VI,l.j9,l.Nd,l.wI,l.yW,l.W2,l.nJ,l.Wo,l.jY,m.sg,l.ju,l.MB],styles:['ion-col[_ngcontent-%COMP%]{border-bottom:1px solid #4b4b4d}ion-col[_ngcontent-%COMP%]   ion-text[_ngcontent-%COMP%]{color:#4b4b4d!important}.header-row[_ngcontent-%COMP%]{border-radius:0%;border:0px}.header-row[_ngcontent-%COMP%]   ion-col[_ngcontent-%COMP%]{text-align:center}.header-row[_ngcontent-%COMP%]   ion-col[_ngcontent-%COMP%]   ion-text[_ngcontent-%COMP%]{color:#fff!important;font-size:1.2rem;text-align:center}.row[_ngcontent-%COMP%]{color:#fff;font-size:1.1rem}.body[_ngcontent-%COMP%]{background-color:#fff;font-family:"Roboto",sans-serif;color:#4b4b4d}']}),s})(),children:[{path:"agency-saw",loadChildren:()=>r.e(9969).then(r.bind(r,9969)).then(s=>s.AgencySawPageModule)},{path:"agency-update",loadChildren:()=>r.e(8592).then(r.bind(r,9226)).then(s=>s.AgencyUpdatePageModule)},{path:"agency-create",loadChildren:()=>r.e(1939).then(r.bind(r,1939)).then(s=>s.AgencyCreatePageModule)}]}];let L=(()=>{class s{}return s.\u0275fac=function(i){return new(i||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({imports:[[u.Bz.forChild(x)],u.Bz]}),s})();var P=r(8816);let E=(()=>{class s{}return s.\u0275fac=function(i){return new(i||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({providers:[y.f],imports:[[m.ez,l.Pc,L,p.u5,p.UX,P.h]]}),s})()}}]);