"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5897],{5897:(M,u,r)=>{r.r(u),r.d(u,{CompanyListPageModule:()=>x});var p=r(6019),g=r(9010),o=r(2651),m=r(8725),d=r(4762),f=r(2115),i=r(865),C=r(7639),y=r(9574),v=r(371),Z=r(9311),L=r(7524);function T(s,c){if(1&s){const t=i.EpF();i.TgZ(0,"ion-row",18),i.TgZ(1,"ion-col",19),i.TgZ(2,"ion-text",20),i.NdJ("click",function(){const a=i.CHM(t).$implicit;return i.oxw().edit(a)}),i._UZ(3,"ion-icon",21),i.qZA(),i.qZA(),i.TgZ(4,"ion-col",19),i.TgZ(5,"ion-text",22),i.NdJ("click",function(){const a=i.CHM(t).$implicit;return i.oxw().showDeleteMenu(a)}),i._UZ(6,"ion-icon",23),i.qZA(),i.qZA(),i.TgZ(7,"ion-col",24),i.TgZ(8,"ion-text"),i._uU(9),i.qZA(),i.qZA(),i.qZA()}if(2&s){const t=c.$implicit;i.xp6(9),i.hij(" ",t.cia_Name," ")}}const P=[{path:"",component:(()=>{class s{constructor(t,e,n,a,l,h,b,A){this.is=t,this.as=e,this.AlertCtrl=n,this.modalCtrl=a,this.pt=l,this.uts=h,this.authS=b,this.us=A,this.companies=[],this.oldCompanies=[],this.searchStr=""}ngOnInit(){}ionViewWillEnter(){return(0,d.mG)(this,void 0,void 0,function*(){this.niTems=Math.ceil(this.pt.height()/20+10),console.log(this.is.added),this.is.added?(this.reset(null),this.is.added=!1):yield this.loadCompanies()})}loadCompanies(t){return(0,d.mG)(this,void 0,void 0,function*(){let e=[];0==this.companies.length&&(yield this.uts.presentLoading(),this.infinite.disabled=!1,this.oldInfinite=!1,e=yield this.is.getAllPaged(this.niTems,1),this.companies=this.companies.concat(e),this.companies=this.sortList(this.companies),this.oldCompanies=[],this.oldCompanies=this.oldCompanies.concat(e)),e.length<this.niTems&&(this.infinite.disabled=!0,this.oldInfinite=!0),t&&t.target.complete(),yield this.uts.hideLoading()})}edit(t){return(0,d.mG)(this,void 0,void 0,function*(){try{const e=yield this.modalCtrl.create({component:f.t,cssClass:"fullscreen",componentProps:{company:t}});yield e.present();const n=yield e.onDidDismiss();if(null!=n.data){let a=this.companies.indexOf(t);this.companies[a]=n.data.newCompany,this.oldCompanies.forEach(l=>{if(l.id==n.data.newCompany.id){let h=this.oldCompanies.indexOf(l);this.oldCompanies[h]=this.companies[a]}})}}catch(e){console.log(e)}})}delete(t){return(0,d.mG)(this,void 0,void 0,function*(){yield this.uts.presentLoading();let e=yield this.as.getByCompany(t.cia_Name);if(yield this.uts.hideLoading(),e.length>0)this.uts.presentToast("No se puede eliminar la Compa\xf1ia de Seguros porque existen agencias relacionadas.","danger","ban");else{yield this.uts.presentLoading();const n=yield this.is.delete(t);let a=this.companies.indexOf(t);yield this.uts.hideLoading(),n?(a>-1&&this.companies.splice(a,1),this.oldCompanies.forEach(l=>{if(l.id==t.id){let h=this.oldCompanies.indexOf(l);this.oldCompanies.splice(h,1)}}),this.uts.presentToast("Compa\xeda eliminada correctamente.","success","checkmark-circle-outline")):this.uts.presentToast("Error al eliminar la compa\xf1ia.","danger","ban")}})}showDeleteMenu(t){return(0,d.mG)(this,void 0,void 0,function*(){yield(yield this.AlertCtrl.create({header:"Confirmaci\xf3n",message:"\xbfDesea eliminar esta compa\xf1ia?",buttons:[{text:"Eliminar",cssClass:"rojo",handler:()=>{this.delete(t)}},{text:"Cancelar",cssClass:"secondary",role:"cancel"}]})).present()})}infiniteLoad(t){return(0,d.mG)(this,void 0,void 0,function*(){let e=[];this.infinite.disabled||(e=yield this.is.getAllPaged(this.niTems,this.companies.length),e=this.sortList(e),this.companies=this.companies.concat(e),this.oldCompanies=this.oldCompanies.concat(e),e.length<30&&(this.infinite.disabled=!0,this.oldInfinite=!0))})}reset(t){return(0,d.mG)(this,void 0,void 0,function*(){this.infinite.disabled=!1,this.oldInfinite=!1,this.companies=[],this.loadCompanies(t)})}logout(){this.authS.logout()}searchChange(){return(0,d.mG)(this,void 0,void 0,function*(){this.searchStr=this.sb.value;let t=[],e=[];this.companies=[];let n=this.searchStr.length;n>0?(yield this.uts.presentLoading(),e=yield this.is.getByCiaName(this.searchStr),e.forEach(a=>{let l=!0;t.forEach(h=>{h.id==a.id&&(l=!1)}),l&&t.push(a)}),this.companies=t,this.companies=this.sortList(this.companies),this.infinite.disabled=!0,yield this.uts.hideLoading()):n<1&&(this.companies=[],this.companies=this.companies.concat(this.oldCompanies),this.companies=this.sortList(this.companies),this.infinite.disabled=this.oldInfinite,yield this.uts.hideLoading())})}sortList(t){return null!=t&&t.length>1&&(t=t.sort((e,n)=>e.cia_Name>n.cia_Name?1:e.cia_Name<n.cia_Name?-1:e.id>n.id?1:e.id<n.id?-1:0)),t}}return s.\u0275fac=function(t){return new(t||s)(i.Y36(C.r),i.Y36(y.Y),i.Y36(o.Br),i.Y36(o.IN),i.Y36(o.t4),i.Y36(v.f),i.Y36(Z.e),i.Y36(L.K))},s.\u0275cmp=i.Xpm({type:s,selectors:[["app-company-list"]],viewQuery:function(t,e){if(1&t&&(i.Gf(o.ju,5),i.Gf(o.VI,5)),2&t){let n;i.iGM(n=i.CRH())&&(e.infinite=n.first),i.iGM(n=i.CRH())&&(e.sb=n.first)}},decls:21,vars:3,consts:[[3,"translucent"],["color","primary"],["slot","end",1,"icon-div-container",2,"margin-right","1%"],["title","Nuevo","routerLink","/tab-administrator/company/create"],["slot","end",1,"icon-logout",2,"pointer-events","none","zoom","1.5","cursor","pointer","content","url(../../../../assets/icon/add-circle-outline.png)"],["title","Lista de Agencias","routerLink","/tab-administrator/agency/list"],["slot","end",1,"icon-logout",2,"pointer-events","none","zoom","1.3","cursor","pointer","content","url( ../../../../assets/icon/agency_list.png)"],["title","Cerrar Sesi\xf3n",3,"click"],["slot","end","name","log-out-outline",1,"icon-logout",2,"pointer-events","none","zoom","1.7","cursor","pointer"],["color","primary",2,"padding-bottom","1%"],["placeholder","Encuentra la compa\xf1\xeda que est\xe1s buscando...","debounce","1000","inputmode","text","type","text","showCancelButton","always",3,"ionChange"],[2,"background-color","white",3,"fullscreen"],["slot","fixed",3,"ionRefresh"],[1,"body"],[1,"ion-text-center"],["let","","class","row",4,"ngFor","ngForOf"],["threshold","100px",3,"ionInfinite"],["loadingSpinner","bubbles","loadingText",""],["let","",1,"row"],["size","0.4"],["title","Editar",1,"icon-div-container",3,"click"],["name","pencil",2,"color","#22388c","pointer-events","none"],["title","Eliminar",1,"icon-div-container",3,"click"],["name","trash","color","danger",2,"pointer-events","none"],["size","11.2",1,"left"]],template:function(t,e){1&t&&(i.TgZ(0,"ion-header",0),i.TgZ(1,"ion-toolbar",1),i.TgZ(2,"ion-title"),i._uU(3,"Lista de Compa\xf1ias de Seguros"),i.qZA(),i.TgZ(4,"ion-buttons",2),i.TgZ(5,"div",3),i._UZ(6,"ion-icon",4),i.qZA(),i.TgZ(7,"div",5),i._UZ(8,"ion-icon",6),i.qZA(),i.TgZ(9,"div",7),i.NdJ("click",function(){return e.logout()}),i._UZ(10,"ion-icon",8),i.qZA(),i.qZA(),i.qZA(),i.TgZ(11,"ion-toolbar",9),i.TgZ(12,"ion-searchbar",10),i.NdJ("ionChange",function(){return e.searchChange()}),i.qZA(),i.qZA(),i.qZA(),i.TgZ(13,"ion-content",11),i.TgZ(14,"ion-refresher",12),i.NdJ("ionRefresh",function(a){return e.reset(a)}),i._UZ(15,"ion-refresher-content"),i.qZA(),i.TgZ(16,"div",13),i.TgZ(17,"ion-grid",14),i.YNc(18,T,10,1,"ion-row",15),i.qZA(),i.TgZ(19,"ion-infinite-scroll",16),i.NdJ("ionInfinite",function(a){return e.infiniteLoad(a)}),i._UZ(20,"ion-infinite-scroll-content",17),i.qZA(),i.qZA(),i.qZA()),2&t&&(i.Q6J("translucent",!1),i.xp6(13),i.Q6J("fullscreen",!0),i.xp6(5),i.Q6J("ngForOf",e.companies))},directives:[o.Gu,o.sr,o.wd,o.Sm,o.YI,m.rH,o.gu,o.VI,o.j9,o.W2,o.nJ,o.Wo,o.jY,p.sg,o.ju,o.MB,o.Nd,o.wI,o.yW],styles:['ion-col[_ngcontent-%COMP%]{border-bottom:1px solid #4b4b4d}ion-col[_ngcontent-%COMP%]   ion-text[_ngcontent-%COMP%]{color:#4b4b4d!important}.header-row[_ngcontent-%COMP%]{border-radius:0%;border:0px}.header-row[_ngcontent-%COMP%]   ion-col[_ngcontent-%COMP%]{text-align:center}.header-row[_ngcontent-%COMP%]   ion-col[_ngcontent-%COMP%]   ion-text[_ngcontent-%COMP%]{color:#fff!important;font-size:1.2rem;text-align:center}.row[_ngcontent-%COMP%]{color:#fff;font-size:1.1rem}.body[_ngcontent-%COMP%]{background-color:#fff;font-family:"Roboto",sans-serif;color:#4b4b4d}ion-icon[_ngcontent-%COMP%]{pointer-events:none}']}),s})()}];let _=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=i.oAB({type:s}),s.\u0275inj=i.cJS({imports:[[m.Bz.forChild(P)],m.Bz]}),s})(),x=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=i.oAB({type:s}),s.\u0275inj=i.cJS({imports:[[p.ez,o.Pc,_,g.u5,g.UX]]}),s})()}}]);