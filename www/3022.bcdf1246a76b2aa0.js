"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[3022],{3022:(S,d,s)=>{s.d(d,{K:()=>P});var l=s(4762),o=s(9010),i=s(2651),u=s(5764),c=s(6092),e=s(865),m=s(7928),_=s(371),Z=s(1249),h=s(9574),f=s(6019);function C(n,p){if(1&n){const r=e.EpF();e.TgZ(0,"ion-datetime",34,35),e.NdJ("ionChange",function(){e.CHM(r);const t=e.MAs(1);return e.oxw().changeDateRepair(t.value)}),e.TgZ(2,"ion-buttons",36),e.TgZ(3,"ion-button",37),e.NdJ("click",function(){return e.CHM(r),e.oxw().confirm()}),e._uU(4,"Aceptar"),e.qZA(),e.TgZ(5,"ion-button",37),e.NdJ("click",function(){return e.CHM(r),e.oxw().reset()}),e._uU(6,"Cancelar"),e.qZA(),e.qZA(),e.qZA()}if(2&n){const r=e.oxw();e.Q6J("value",r.stringDateRepair)}}function T(n,p){1&n&&(e.TgZ(0,"p",38),e._uU(1," *Si se va a asignar la reparaci\xf3n como completada, la fecha de reparaci\xf3n debe ser posterior a la del alta.. "),e.qZA())}function R(n,p){1&n&&(e.TgZ(0,"p",38),e._uU(1," *Campo obligatorio. Introduzca alg\xfan valor. "),e.qZA())}function A(n,p){1&n&&(e.TgZ(0,"p",38),e._uU(1," *Si se va a asignar la reparaci\xf3n como completada, el coste no puede ser 0 \u20ac. "),e.qZA())}function v(n,p){1&n&&(e.TgZ(0,"p",38),e._uU(1," *Campo obligatorio. Introduzca un valor entero. "),e.qZA())}function q(n,p){1&n&&(e.TgZ(0,"p",38),e._uU(1," *Si se va a asignar la reparaci\xf3n como completada, los puntos no pueden ser inferiores a 1. "),e.qZA())}let P=(()=>{class n{constructor(r,a,t,g,U,b){this.modalController=r,this.carRepairService=a,this.formBuilder=t,this.uts=g,this.dateTimeService=U,this.as=b,this.dateValue=""}ngOnInit(){this.spanishDateOrder=this.dateTimeService.formatSpanishDateString(""+this.carRepair.dateOrder),this.carRepair.dateRepair&&(this.spanishDateRepair=this.dateTimeService.formatSpanishDateString(""+this.carRepair.dateRepair),this.formatedString=this.dateTimeService.formatString(""+this.carRepair.dateRepair)),this.formCarRepair=this.formBuilder.group({operation:[this.carRepair.operation,[o.kI.required]],carPlate:[this.carRepair.carPlate.toUpperCase(),[o.kI.required]],model:[this.carRepair.model,[o.kI.required]],brandCar:[this.carRepair.brandCar,[o.kI.required]],clienteName:[this.carRepair.clienteName,[o.kI.required]],nor:[this.carRepair.nor,[o.kI.required]],amount:[this.carRepair.amount,o.kI.required],asigPoints:[this.carRepair.asigPoints,[o.kI.required,o.kI.pattern("[0-9]+")]],myAgency:[this.carRepair.myAgency.myUser.name],dateOrder:[this.carRepair.dateOrder,[o.kI.required]],spanishDateOrder:[this.spanishDateOrder],dateRepair:[this.carRepair.dateRepair],repaired:[this.carRepair.repaired,[o.kI.required]]})}ionViewDidEnter(){return(0,l.mG)(this,void 0,void 0,function*(){})}editCarRepair(){return(0,l.mG)(this,void 0,void 0,function*(){yield this.uts.presentLoading();let r=!0;if(console.log(this.carRepair.dateOrder),null!=this.formatedString&&!this.dateTimeService.validateDates(this.dateTimeService.formatString(this.carRepair.dateOrder.toString()),this.dateTimeService.formatString(this.formatedString))&&(r=!1,this.uts.presentToast("La fecha de reparaci\xf3n no puede ser anterior a la de alta.","danger","ban")),this.formCarRepair.get("asigPoints").value<1&&1==this.formCarRepair.get("repaired").value&&(r=!1,this.uts.presentToast("No se puede asignar una reparaci\xf3n como terminada a 0 puntos.","danger","ban")),0==this.formCarRepair.get("amount").value&&1==this.formCarRepair.get("repaired").value&&(r=!1,this.uts.presentToast("No se puede asignar una reparaci\xf3n como terminada con un coste de 0 \u20ac.","danger","ban")),r){this.newCarRepair={id:this.carRepair.id,operation:this.formCarRepair.get("operation").value,carPlate:this.carRepair.carPlate,model:this.carRepair.model,brandCar:this.carRepair.brandCar,clienteName:this.formCarRepair.get("clienteName").value,dateOrder:this.formCarRepair.get("dateOrder").value,nor:this.formCarRepair.get("nor").value,amount:this.formCarRepair.get("amount").value,dateRepair:this.formatedString,asigPoints:this.formCarRepair.get("asigPoints").value,repaired:this.formCarRepair.get("repaired").value,myAgency:this.carRepair.myAgency};try{this.newCarRepair=yield this.carRepairService.createOrUpdate(this.newCarRepair),this.newCarRepair?(this.modalController.dismiss({newCarRepair:this.newCarRepair}),this.uts.presentToast("Se ha gurdadado correctamente.","success","checkmark-circle-outline"),this.as.added=!0):(this.uts.presentToast("Fallo al actualizar la reparaci\xf3n. Int\xe9ntelo m\xe1s tarde.","danger","ban"),this.closeModal())}catch(a){this.uts.presentToast("Fallo al actualizar la reparaci\xf3n. Int\xe9ntelo m\xe1s tarde.","danger","ban"),console.log(a)}}this.uts.hideLoading()})}closeModal(){this.modalController.dismiss()}confirm(){this.datetime.confirm(!0),this.validateForm()}reset(){this.datetime.cancel(!0)}formatDate(r){return(0,u.Z)((0,c.Z)(r),"yyyy-MM-dd HH:mm:SS")}changeDateRepair(r){this.spanishDateRepair=this.dateTimeService.formatSpanishDateString(r),this.stringDateRepair=this.dateTimeService.formatString(r),this.dateValue=r,this.formatedString=this.formatDate(this.dateValue),this.validateForm()}validateForm(){this.errorForm=!1,1==this.formCarRepair.get("repaired").value&&((null==this.formatedString||!this.dateTimeService.validateDates(this.dateTimeService.formatString(this.carRepair.dateOrder.toString()),this.dateTimeService.formatString(this.formatedString)))&&(this.errorForm=!0),0==this.formCarRepair.get("asigPoints").value&&1==this.formCarRepair.get("repaired").value&&(this.errorForm=!0),this.formCarRepair.get("amount").value<1&&1==this.formCarRepair.get("repaired").value&&(this.errorForm=!0))}}return n.\u0275fac=function(r){return new(r||n)(e.Y36(i.IN),e.Y36(m.K),e.Y36(o.qu),e.Y36(_.f),e.Y36(Z.Y),e.Y36(h.Y))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-car-repair-update"]],viewQuery:function(r,a){if(1&r&&e.Gf(i.x4,5),2&r){let t;e.iGM(t=e.CRH())&&(a.datetime=t.first)}},inputs:{carRepair:"carRepair"},decls:107,vars:10,consts:[[3,"translucent"],["color","primary"],[3,"fullscreen"],[1,"body"],[1,"ion-padding",3,"formGroup"],[1,"formulario"],[1,"ion-align-items-center"],["sizeSm","2","sizeLg","2"],["sizeSm","4","sizeLg","4"],["Disabled","","type","text","formControlName","spanishDateOrder",1,"customInput"],["sizeSm","3.2","sizeLg","6"],["button","true","id","open-date-input"],["slot","end"],["trigger","open-date-input","show-backdrop","false"],["style","color:red;",4,"ngIf"],["sizeSm","10","sizeLg","10"],["type","number","min","0","max","99999","inputmode","numeric","formControlName","operation",1,"customInput",3,"ionChange"],["sizeSm","11","sizeLg","10"],["Disabled","","type","text","formControlName","carPlate",1,"customInput",3,"ionChange"],["sizeSm","5","sizeLg","10"],["Disabled","","type","text","formControlName","model",1,"customInput",3,"ionChange"],["Disabled","","type","text","formControlName","brandCar",1,"customInput",3,"ionChange"],["type","text","formControlName","clienteName",1,"customInput",3,"ionChange"],["type","number","formControlName","nor",1,"customInput"],["type","number","formControlName","amount",1,"customInput",3,"ionChange"],["type","number","formControlName","asigPoints",1,"customInput",3,"ionChange"],["Disabled","","type","text","formControlName","myAgency",1,"customInput",3,"ionChange"],["sizeSm","7","sizeLg","2"],["sizeSm","7","sizeLg","4"],["lines","none"],["formControlName","repaired",3,"ionChange"],["size","6"],["expand","block","shape","round",1,"button",2,"margin-top","2% !important",3,"click"],["expand","block","shape","round",1,"button",2,"margin-top","2% !important",3,"disabled","click"],["color","secondary",3,"value","ionChange"],["popoverDatetime",""],["slot","buttons"],["shape","round",1,"button",3,"click"],[2,"color","red"]],template:function(r,a){1&r&&(e.TgZ(0,"ion-header",0),e.TgZ(1,"ion-toolbar",1),e.TgZ(2,"ion-title"),e._uU(3,"Editar Reparaci\xf3n"),e.qZA(),e.qZA(),e.qZA(),e.TgZ(4,"ion-content",2),e.TgZ(5,"div",3),e.TgZ(6,"form",4),e.TgZ(7,"div",5),e.TgZ(8,"ion-grid"),e.TgZ(9,"ion-row",6),e.TgZ(10,"ion-col",7),e.TgZ(11,"ion-label"),e._uU(12,"Fecha de alta: "),e.qZA(),e.qZA(),e.TgZ(13,"ion-col",8),e._UZ(14,"ion-input",9),e.qZA(),e.TgZ(15,"ion-col",10),e.TgZ(16,"ion-item",11),e.TgZ(17,"ion-label"),e._uU(18,"Fecha de reparaci\xf3n:"),e.qZA(),e.TgZ(19,"ion-text",12),e._uU(20),e.qZA(),e.TgZ(21,"ion-popover",13),e.YNc(22,C,7,1,"ng-template"),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.TgZ(23,"ion-row",6),e.TgZ(24,"ion-col"),e.YNc(25,T,2,0,"p",14),e.qZA(),e.qZA(),e.TgZ(26,"ion-row",6),e.TgZ(27,"ion-col",7),e.TgZ(28,"ion-label"),e._uU(29,"Operaci\xf3n: "),e.qZA(),e.qZA(),e.TgZ(30,"ion-col",15),e.TgZ(31,"ion-input",16),e.NdJ("ionChange",function(){return a.validateForm()}),e.qZA(),e.qZA(),e.qZA(),e.TgZ(32,"ion-row",6),e.TgZ(33,"ion-col",7),e.TgZ(34,"ion-label"),e._uU(35,"Matr\xedcula: "),e.qZA(),e.qZA(),e.TgZ(36,"ion-col",17),e.TgZ(37,"ion-input",18),e.NdJ("ionChange",function(){return a.validateForm()}),e.qZA(),e.qZA(),e.qZA(),e.TgZ(38,"ion-row",6),e.TgZ(39,"ion-col",7),e.TgZ(40,"ion-label"),e._uU(41,"Modelo: "),e.qZA(),e.qZA(),e.TgZ(42,"ion-col",19),e.TgZ(43,"ion-input",20),e.NdJ("ionChange",function(){return a.validateForm()}),e.qZA(),e.qZA(),e.qZA(),e.TgZ(44,"ion-row",6),e.TgZ(45,"ion-col",7),e.TgZ(46,"ion-label"),e._uU(47,"Marca: "),e.qZA(),e.qZA(),e.TgZ(48,"ion-col",19),e.TgZ(49,"ion-input",21),e.NdJ("ionChange",function(){return a.validateForm()}),e.qZA(),e.qZA(),e.qZA(),e.TgZ(50,"ion-row",6),e.TgZ(51,"ion-col",7),e.TgZ(52,"ion-label"),e._uU(53,"Cliente: "),e.qZA(),e.qZA(),e.TgZ(54,"ion-col",15),e.TgZ(55,"ion-input",22),e.NdJ("ionChange",function(){return a.validateForm()}),e.qZA(),e.qZA(),e.qZA(),e.TgZ(56,"ion-row",6),e.TgZ(57,"ion-col",7),e.TgZ(58,"ion-label"),e._uU(59,"NOR: "),e.qZA(),e.qZA(),e.TgZ(60,"ion-col",15),e._UZ(61,"ion-input",23),e.qZA(),e.qZA(),e.TgZ(62,"ion-row",6),e.TgZ(63,"ion-col",7),e.TgZ(64,"ion-label"),e._uU(65,"Coste: "),e.qZA(),e.qZA(),e.TgZ(66,"ion-col",15),e.TgZ(67,"ion-input",24),e.NdJ("ionChange",function(){return a.validateForm()}),e.qZA(),e.qZA(),e.qZA(),e.TgZ(68,"ion-row",6),e.TgZ(69,"ion-col"),e.YNc(70,R,2,0,"p",14),e.qZA(),e.qZA(),e.TgZ(71,"ion-row",6),e.TgZ(72,"ion-col"),e.YNc(73,A,2,0,"p",14),e.qZA(),e.qZA(),e.TgZ(74,"ion-row",6),e.TgZ(75,"ion-col",7),e.TgZ(76,"ion-label"),e._uU(77,"Puntos: "),e.qZA(),e.qZA(),e.TgZ(78,"ion-col",15),e.TgZ(79,"ion-input",25),e.NdJ("ionChange",function(){return a.validateForm()}),e.qZA(),e.qZA(),e.qZA(),e.TgZ(80,"ion-row",6),e.TgZ(81,"ion-col"),e.YNc(82,v,2,0,"p",14),e.qZA(),e.qZA(),e.TgZ(83,"ion-row",6),e.TgZ(84,"ion-col"),e.YNc(85,q,2,0,"p",14),e.qZA(),e.qZA(),e.TgZ(86,"ion-row",6),e.TgZ(87,"ion-col",7),e.TgZ(88,"ion-label"),e._uU(89,"Agencia: "),e.qZA(),e.qZA(),e.TgZ(90,"ion-col",15),e.TgZ(91,"ion-input",26),e.NdJ("ionChange",function(){return a.validateForm()}),e.qZA(),e.qZA(),e.qZA(),e.TgZ(92,"ion-row",6),e.TgZ(93,"ion-col",27),e._uU(94," Reparado: "),e.qZA(),e.TgZ(95,"ion-col",28),e.TgZ(96,"ion-item",29),e._uU(97," No"),e.TgZ(98,"ion-toggle",30),e.NdJ("ionChange",function(){return a.validateForm()}),e.qZA(),e._uU(99,"Si "),e.qZA(),e.qZA(),e.qZA(),e.TgZ(100,"ion-row",6),e.TgZ(101,"ion-col",31),e.TgZ(102,"ion-button",32),e.NdJ("click",function(){return a.closeModal()}),e._uU(103," Cancelar "),e.qZA(),e.qZA(),e.TgZ(104,"ion-col",31),e.TgZ(105,"ion-button",33),e.NdJ("click",function(){return a.editCarRepair()}),e._uU(106," Guardar "),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&r&&(e.Q6J("translucent",!0),e.xp6(4),e.Q6J("fullscreen",!0),e.xp6(2),e.Q6J("formGroup",a.formCarRepair),e.xp6(14),e.Oqu(a.spanishDateRepair),e.xp6(5),e.Q6J("ngIf",null!=a.formatedString&&!a.dateTimeService.validateDates(a.dateTimeService.formatString(a.carRepair.dateOrder.toString()),a.dateTimeService.formatString(a.formatedString))&&1==a.errorForm),e.xp6(45),e.Q6J("ngIf",a.formCarRepair.get("amount").invalid&&a.formCarRepair.get("amount").touched),e.xp6(3),e.Q6J("ngIf",1==a.formCarRepair.get("repaired").value&&a.formCarRepair.get("amount").value<1),e.xp6(9),e.Q6J("ngIf",a.formCarRepair.get("asigPoints").invalid&&a.formCarRepair.get("asigPoints").touched),e.xp6(3),e.Q6J("ngIf",1==a.formCarRepair.get("repaired").value&&a.formCarRepair.get("asigPoints").value<1),e.xp6(20),e.Q6J("disabled",a.formCarRepair.invalid||a.errorForm))},directives:[i.Gu,i.sr,i.wd,i.W2,o._Y,o.JL,o.sg,i.jY,i.Nd,i.wI,i.Q$,i.pK,i.j9,o.JJ,o.u,i.Ie,i.yW,i.d8,f.O5,i.as,i.ho,i.w,i.YG,i.x4,i.QI,i.Sm],styles:[".body[_ngcontent-%COMP%]{background:#717499;background-size:cover;min-height:100%}.button[_ngcontent-%COMP%]{--background: #22388c;color:#fff}.secundaryInput[_ngcontent-%COMP%]{margin-left:5%}.date[_ngcontent-%COMP%]{margin-left:20%}.buttonDate[_ngcontent-%COMP%]{background-color:#717499}ion-input.ng-invalid.ng-touched[_ngcontent-%COMP%]{border-left:5px solid #a94442;border-right:5px solid #a94442}ion-input.ng-valid.ng-dirty[_ngcontent-%COMP%]{border-left:5px solid #42A948;border-right:5px solid #42A948}select.ng-invalid.ng-touched[_ngcontent-%COMP%]{border-left:5px solid #a94442;border-right:5px solid #a94442}select.ng-valid.ng-dirty[_ngcontent-%COMP%]{border-left:5px solid #42A948;border-right:5px solid #42A948}"]}),n})()}}]);